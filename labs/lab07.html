

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Lab 7: Crime and Penalty &#8212; Demo Data-8 Book Chapter</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/jupyter-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-dropdown.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-bootstrap.min.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/mystnb.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.18.0/dist/embed-amd.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Demo Data-8 Book Chapter</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  
  <ul class="nav sidenav_l1">
  <li class="">
    <a href="../data8/Estimation.html">Data 8 demo</a>
  </li>
  <li class="">
    <a href="../ds100/viz_intro.html">Data 100 demo</a>
  </li>
</ul>
</nav>

 <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/labs/lab07.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/choldgraf/utoronto-demo"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/choldgraf/utoronto-demo/issues/new?title=Issue%20on%20page%20%2Flabs/lab07.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/choldgraf/utoronto-demo/edit/master/labs/lab07.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/choldgraf/utoronto-demo/master?urlpath=lab/tree/labs/lab07.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://utoronto.2i2c.cloud/hub/user-redirect/git-pull?repo=https://github.com/choldgraf/utoronto-demo&urlpath=lab/tree/utoronto-demo/labs/lab07.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

    </div>
    <div class="d-none d-md-block col-md-2 bd-toc show">
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#a-b-testing" class="nav-link">1. A/B Testing</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#murder-rates" class="nav-link">2: Murder Rates</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#the-data" class="nav-link">The data</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#the-death-penalty" class="nav-link">3. The Death Penalty</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#a-natural-experiment" class="nav-link">A Natural Experiment</a>
        </li>
    
            </ul>
        </li>
    
    </ul>
</nav>



<div class="tocsection editthispage">
    <a href="https://github.com/choldgraf/utoronto-demo/edit/master/labs/lab07.ipynb">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize OK</span>
<span class="kn">from</span> <span class="nn">client.api.notebook</span> <span class="kn">import</span> <span class="n">Notebook</span>
<span class="n">ok</span> <span class="o">=</span> <span class="n">Notebook</span><span class="p">(</span><span class="s1">&#39;lab07.ok&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="lab-7-crime-and-penalty">
<h1>Lab 7: Crime and Penalty<a class="headerlink" href="#lab-7-crime-and-penalty" title="Permalink to this headline">¶</a></h1>
<p>Welcome to Lab 7!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run this cell to set up the notebook, but please don&#39;t change it.</span>

<span class="c1"># These lines import the Numpy and Datascience modules.</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">datascience</span> <span class="kn">import</span> <span class="o">*</span>

<span class="c1"># These lines do some fancy plotting magic.</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;fivethirtyeight&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="ne">FutureWarning</span><span class="p">)</span>

<span class="c1"># These lines load the tests.</span>
<span class="kn">from</span> <span class="nn">client.api.notebook</span> <span class="kn">import</span> <span class="n">Notebook</span>
<span class="n">ok</span> <span class="o">=</span> <span class="n">Notebook</span><span class="p">(</span><span class="s1">&#39;lab07.ok&#39;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ok</span><span class="o">.</span><span class="n">auth</span><span class="p">(</span><span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="a-b-testing">
<h2>1. A/B Testing<a class="headerlink" href="#a-b-testing" title="Permalink to this headline">¶</a></h2>
<p>A/B testing is a form of hypothesis testing that allows you to make comparisons between two distributions.</p>
<p>You’ll almost never be explicitly asked to perform an A/B test. Make sure you can identify situations where the test is appropriate and know how to correctly implement each step.</p>
<p><strong>Question 1.1:</strong> The following statements are the unordered steps of an A/B hypothesis test:</p>
<ol class="simple">
<li><p>Choose a test statistic (typically the difference in means between two categories)</p></li>
<li><p>Shuffle the labels of the original sample, find your simulated test statistic, and repeat many times</p></li>
<li><p>Find the value of the observed test statistic</p></li>
<li><p>Calculate the p-value based off your observed and simulated test statistics</p></li>
<li><p>Define a null and alternate model</p></li>
<li><p>Use the p-value and p-value cutoff to draw a conclusion about the null hypothesis</p></li>
</ol>
<p>Make an array called <code class="docutils literal notranslate"><span class="pre">ab_test_order</span></code> that contains the correct order of an A/B test, where the first item of the array is the first step of an A/B test and the last item of the array is the last step of an A/B test</p>
<!--
BEGIN QUESTION
name: q1_1
--><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ab_test_order</span> <span class="o">=</span> <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ok</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span><span class="s2">&quot;q1_1&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Question 1.2:</strong> If the null hypothesis of an A/B test is correct, should the order of labels affect the differences in means between each group? Why do we shuffle labels in an A/B test?</p>
<!--
BEGIN QUESTION
name: q1_2
--><p><em>Write your answer here, replacing this text.</em></p>
</div>
<div class="section" id="murder-rates">
<h2>2: Murder Rates<a class="headerlink" href="#murder-rates" title="Permalink to this headline">¶</a></h2>
<p>Punishment for crime has many <a class="reference external" href="http://plato.stanford.edu/entries/punishment/#ThePun">philosophical justifications</a>.  An important one is that fear of punishment may <em>deter</em> people from committing crimes.</p>
<p>In the United States, some jurisdictions execute people who are convicted of particularly serious crimes, such as murder.  This punishment is called the <em>death penalty</em> or <em>capital punishment</em>.  The death penalty is controversial, and deterrence has been one focal point of the debate.  There are other reasons to support or oppose the death penalty, but in this project we’ll focus on deterrence.</p>
<p>The key question about deterrence is:</p>
<blockquote>
<div><p>Through our exploration, does instituting a death penalty for murder actually reduce the number of murders?</p>
</div></blockquote>
<p>You might have a strong intuition in one direction, but the evidence turns out to be surprisingly complex.  Different sides have variously argued that the death penalty has no deterrent effect and that each execution prevents 8 murders, all using statistical arguments!  We’ll try to come to our own conclusion.</p>
<div class="section" id="the-data">
<h3>The data<a class="headerlink" href="#the-data" title="Permalink to this headline">¶</a></h3>
<p>The main data source for this lab comes from a <a class="reference external" href="http://cjlf.org/deathpenalty/DezRubShepDeterFinal.pdf">paper</a> by three researchers, Dezhbakhsh, Rubin, and Shepherd.  The dataset contains rates of various violent crimes for every year 1960-2003 (44 years) in every US state.  The researchers compiled the data from the FBI’s Uniform Crime Reports.</p>
<p>Since crimes are committed by people, not states, we need to account for the number of people in each state when we’re looking at state-level data.  Murder rates are calculated as follows:</p>
<div class="math notranslate nohighlight" id="equation-murder-is-rare-so-we-multiply-by-100-000-just-to-avoid-dealing-with-tiny-numbers">
<span class="eqno">()<a class="headerlink" href="#equation-murder-is-rare-so-we-multiply-by-100-000-just-to-avoid-dealing-with-tiny-numbers" title="Permalink to this equation">¶</a></span>\[\text{murder rate for state X in year Y} = \frac{\text{number of murders in state X in year Y}}{\text{population in state X in year Y}}*100000\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">murder_rates</span> <span class="o">=</span> <span class="n">Table</span><span class="o">.</span><span class="n">read_table</span><span class="p">(</span><span class="s1">&#39;crime_rates.csv&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Population&#39;</span><span class="p">,</span> <span class="s1">&#39;Murder Rate&#39;</span><span class="p">)</span>
<span class="n">murder_rates</span><span class="o">.</span><span class="n">set_format</span><span class="p">(</span><span class="s2">&quot;Population&quot;</span><span class="p">,</span> <span class="n">NumberFormatter</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Murder rates vary over time, and different states exhibit different trends. The rates in some states change dramatically from year to year, while others are quite stable. Let’s plot a couple, just to see the variety.</p>
<p><strong>Question 2.1.</strong> Draw a line plot with years on the horizontal axis and murder rates on the
vertical axis. Include two lines: one for Alaska murder rates and one for Minnesota murder rates. Create this plot using a single call, <code class="docutils literal notranslate"><span class="pre">ak_mn.plot('Year')</span></code>.</p>
<p><em>Hint</em>: To create two lines, you will need create the table <code class="docutils literal notranslate"><span class="pre">ak_mn</span></code> with two columns of murder rates, in addition to a column of years. This table will have the following structure:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Year</p></th>
<th class="head"><p>Murder rate in Alaska</p></th>
<th class="head"><p>Murder rate in Minnesota</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1960</p></td>
<td><p>10.2</p></td>
<td><p>1.2</p></td>
</tr>
<tr class="row-odd"><td><p>1961</p></td>
<td><p>11.5</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>1962</p></td>
<td><p>4.5</p></td>
<td><p>0.9</p></td>
</tr>
</tbody>
</table>
<center>... (41 rows omitted)</center>
<!--
BEGIN QUESTION
name: q2_1
--><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># The next lines are provided for you.  They create a table</span>
<span class="c1"># containing only the Alaska information and one containing</span>
<span class="c1"># only the Minnesota information.</span>
<span class="n">ak</span> <span class="o">=</span> <span class="n">murder_rates</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;Alaska&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;Population&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">relabeled</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Murder rate in Alaska&#39;</span><span class="p">)</span>
<span class="n">mn</span> <span class="o">=</span> <span class="n">murder_rates</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;Minnesota&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;Population&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">relabeled</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Murder rate in Minnesota&#39;</span><span class="p">)</span>

<span class="c1"># Fill in this line to make a table like the one pictured above.</span>
<span class="n">ak_mn</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">ak_mn</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ok</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span><span class="s2">&quot;q2_1&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Question 2.2:</strong> Using the table <code class="docutils literal notranslate"><span class="pre">ak_mn</span></code>, draw a line plot that compares the murder rate in Alaska and the murder rate in Minnesota over time.</p>
<!--
BEGIN QUESTION
name: q2_2
--><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Draw your line plot here</span>
<span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<p>Now what about the murder rates of other states? Say, for example, California and New York? Run the cell below to plot the murder rates of different pairs of states.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare the murder rates of any two states by filling in the blanks below</span>

<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">fixed</span><span class="p">,</span> <span class="n">interact_manual</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>

<span class="k">def</span> <span class="nf">state</span><span class="p">(</span><span class="n">state1</span><span class="p">,</span> <span class="n">state2</span><span class="p">):</span>
    <span class="n">state1_table</span> <span class="o">=</span> <span class="n">murder_rates</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="n">state1</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;Population&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">relabeled</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Murder rate in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">state1</span><span class="p">))</span>
    <span class="n">state2_table</span> <span class="o">=</span> <span class="n">murder_rates</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="n">state2</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">,</span> <span class="s1">&#39;Population&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">relabeled</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Murder rate in </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">state2</span><span class="p">))</span>
    <span class="n">s1_s2</span> <span class="o">=</span> <span class="n">state1_table</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">state2_table</span><span class="p">)</span>
    <span class="n">s1_s2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">states_array</span> <span class="o">=</span> <span class="n">murder_rates</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">)</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">interact</span><span class="p">(</span><span class="n">state</span><span class="p">,</span>
             <span class="n">state1</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">states_array</span><span class="p">),</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;California&#39;</span><span class="p">),</span>
             <span class="n">state2</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Dropdown</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">states_array</span><span class="p">),</span><span class="n">value</span><span class="o">=</span><span class="s1">&#39;New York&#39;</span><span class="p">)</span>
            <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="the-death-penalty">
<h2>3. The Death Penalty<a class="headerlink" href="#the-death-penalty" title="Permalink to this headline">¶</a></h2>
<p>Some US states have the death penalty, and others don’t, and laws have changed over time. In addition to changes in murder rates, we will also consider whether the death penalty was in force in each state and each year.</p>
<p>Using this information, we would like to investigate how the presence of the death penalty affects the murder rate of a state.</p>
<p><strong>Question 3.1.</strong> We want to know whether the death penalty <em>causes</em> a change in the murder rate.  Why is it not sufficient to compare murder rates in places and times when the death penalty was in force with places and times when it wasn’t?</p>
<!--
BEGIN QUESTION
name: q3_1
--><p><em>Write your answer here, replacing this text.</em></p>
<div class="section" id="a-natural-experiment">
<h3>A Natural Experiment<a class="headerlink" href="#a-natural-experiment" title="Permalink to this headline">¶</a></h3>
<p>In order to attempt to investigate the causal relationship between the death penalty and murder rates, we’re going to take advantage of a <em>natural experiment</em>.  A natural experiment happens when something other than experimental design applies a treatment to one group and not to another (control) group, and we have some hope that the treatment and control groups don’t have any other systematic differences.</p>
<p>Our natural experiment is this: in 1972, a Supreme Court decision called <em>Furman v. Georgia</em> banned the death penalty throughout the US.  Suddenly, many states went from having the death penalty to not having the death penalty.</p>
<p>As a first step, let’s see how murder rates changed before and after the court decision.  We’ll define the test as follows:</p>
<blockquote>
<div><p><strong>Population:</strong> All the states that had the death penalty before the 1972 abolition.  (There is no control group for the states that already lacked the death penalty in 1972, so we must omit them.)  This includes all US states <strong>except</strong> Alaska, Hawaii, Maine, Michigan, Wisconsin, and Minnesota.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Treatment group:</strong> The states in that population, in 1973 (the year after 1972).</p>
</div></blockquote>
<blockquote>
<div><p><strong>Control group:</strong> The states in that population, in 1971 (the year before 1972).</p>
</div></blockquote>
<blockquote>
<div><p><strong>Null hypothesis:</strong> Murder rates in 1971 and 1973 come from the same distribution.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Alternative hypothesis:</strong> Murder rates were higher in 1973 than they were in 1971.</p>
</div></blockquote>
<p>Our alternative hypothesis is related to our suspicion that murder rates increase when the death penalty is eliminated.</p>
<p><strong>Question 3.2:</strong> Should we use an A/B test to test these hypotheses? If yes, what is our “A” group and what is our “B” group?</p>
<!--
BEGIN QUESTION
name: q3_2
--><p><em>Write your answer here, replacing this text.</em></p>
<p>The <code class="docutils literal notranslate"><span class="pre">death_penalty</span></code> table below describes whether each state allowed the death penalty in 1971.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">non_death_penalty_states</span> <span class="o">=</span> <span class="n">make_array</span><span class="p">(</span><span class="s1">&#39;Alaska&#39;</span><span class="p">,</span> <span class="s1">&#39;Hawaii&#39;</span><span class="p">,</span> <span class="s1">&#39;Maine&#39;</span><span class="p">,</span> <span class="s1">&#39;Michigan&#39;</span><span class="p">,</span> <span class="s1">&#39;Wisconsin&#39;</span><span class="p">,</span> <span class="s1">&#39;Minnesota&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">had_death_penalty_in_1971</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns True if the argument is the name of a state that had the death penalty in 1971.&quot;&quot;&quot;</span>
    <span class="c1"># The implementation of this function uses a bit of syntax</span>
    <span class="c1"># we haven&#39;t seen before.  Just trust that it behaves as its</span>
    <span class="c1"># documentation claims.</span>
    <span class="k">return</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">non_death_penalty_states</span>

<span class="n">states</span> <span class="o">=</span> <span class="n">murder_rates</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;State&#39;</span><span class="p">)</span>
<span class="n">death_penalty</span> <span class="o">=</span> <span class="n">states</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s1">&#39;Death Penalty&#39;</span><span class="p">,</span> <span class="n">states</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">had_death_penalty_in_1971</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">death_penalty</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Question 3.3:</strong> Use the <code class="docutils literal notranslate"><span class="pre">death_penalty</span></code> and <code class="docutils literal notranslate"><span class="pre">murder_rates</span></code> tables to find murder rates in 1971 for states with the death penalty before the abolition. Create a new table <code class="docutils literal notranslate"><span class="pre">preban_rates</span></code> that contains the same information as <code class="docutils literal notranslate"><span class="pre">murder_rates</span></code>, along with a column <code class="docutils literal notranslate"><span class="pre">Death</span> <span class="pre">Penalty</span></code> that contains booleans (<code class="docutils literal notranslate"><span class="pre">True</span></code> or <code class="docutils literal notranslate"><span class="pre">False</span></code>) describing if states had the death penalty in 1971.</p>
<!--
BEGIN QUESTION
name: q3_3
--><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># States that had death penalty in 1971</span>
<span class="n">preban_rates</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">preban_rates</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ok</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span><span class="s2">&quot;q3_3&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Question 3.4:</strong> Create a table <code class="docutils literal notranslate"><span class="pre">postban_rates</span></code> that contains the same information as <code class="docutils literal notranslate"><span class="pre">preban_rates</span></code>, but for 1973 instead of 1971. <code class="docutils literal notranslate"><span class="pre">postban_rates</span></code> should only contain the states found in <code class="docutils literal notranslate"><span class="pre">preban_rates</span></code>.</p>
<!--
BEGIN QUESTION
name: q3_4
--><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">postban_rates</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">postban_rates</span> <span class="o">=</span> <span class="n">postban_rates</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;State&quot;</span><span class="p">)</span>
<span class="n">postban_rates</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ok</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span><span class="s2">&quot;q3_4&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Question 3.5:</strong> Use <code class="docutils literal notranslate"><span class="pre">preban_rates_copy</span></code> and <code class="docutils literal notranslate"><span class="pre">postban_rates</span></code> to create a table <code class="docutils literal notranslate"><span class="pre">change_in_death_rates</span></code> that contains each state’s population, murder rate, and whether or not that state had the death penalty for both 1971 and 1973.</p>
<p><em>Hint:</em> <code class="docutils literal notranslate"><span class="pre">tbl_1.append(tbl_2)</span></code> with create a new table that includes rows from both <code class="docutils literal notranslate"><span class="pre">tbl_1</span></code> and <code class="docutils literal notranslate"><span class="pre">tbl_2</span></code>. Both tables must have the exactly the same columns, in the same order.</p>
<!--
BEGIN QUESTION
name: q3_5
--><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">preban_rates_copy</span> <span class="o">=</span> <span class="n">preban_rates</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">change_in_death_rates</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">change_in_death_rates</span>
</pre></div>
</div>
</div>
</div>
<p>Run the cell below to view the distribution of death rates during the pre-ban and post-ban time periods.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">change_in_death_rates</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="s1">&#39;Murder Rate&#39;</span><span class="p">,</span> <span class="n">group</span> <span class="o">=</span> <span class="s1">&#39;Death Penalty&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Question 3.6:</strong> Create a table <code class="docutils literal notranslate"><span class="pre">rate_means</span></code> that contains the average murder rates for the states that had the death penalty and the states that didn’t have the death penalty. It should have two columns: one indicating if the penalty was in place, and one that contains the average murder rate for each group.</p>
<!--
BEGIN QUESTION
name: q3_6
--><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rate_means</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">rate_means</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ok</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span><span class="s2">&quot;q3_6&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Question 3.7:</strong> We want to figure out if there is a difference between the distribution of death rates in 1971 and 1973. Specifically, we want to test if murder rates were higher in 1973 than they were in 1971.</p>
<p>What should the test statistic be? How does it help us differentiate whether the data supports the null and alternative?</p>
<p>If you are in lab, confirm your answer with a lab TA/LA before moving on.</p>
<!--
BEGIN QUESTION
name: q3_7
--><p><em>Write your answer here, replacing this text.</em></p>
<p><strong>Question 3.8:</strong> Set <code class="docutils literal notranslate"><span class="pre">observed_difference</span></code> to the observed test statistic using the <code class="docutils literal notranslate"><span class="pre">rate_means</span></code> table</p>
<!--
BEGIN QUESTION
name: q3_8
--><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">observed_difference</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">observed_difference</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ok</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span><span class="s2">&quot;q3_8&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Question 3.9:</strong> Given a table like <code class="docutils literal notranslate"><span class="pre">change_in_death_rates</span></code>, a value column <code class="docutils literal notranslate"><span class="pre">label</span></code>, and a group column <code class="docutils literal notranslate"><span class="pre">group_label</span></code>, write a function that calculates the appropriate test statistic.</p>
<!--
BEGIN QUESTION
name: q3_9
--><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_test_stat</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">labels_col</span><span class="p">,</span> <span class="n">values_col</span><span class="p">):</span>
    <span class="o">...</span>

<span class="n">find_test_stat</span><span class="p">(</span><span class="n">change_in_death_rates</span><span class="p">,</span> <span class="s2">&quot;Death Penalty&quot;</span><span class="p">,</span> <span class="s2">&quot;Murder Rate&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ok</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span><span class="s2">&quot;q3_9&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>When we run a simulation for A/B testing, we resample by shuffling the labels of the original sample. If the null hypothesis is true and the murder rate distributions are the same, we expect that the difference in mean death rates will be not change when “Death Penalty” labels are changed.</p>
<p><strong>Question 3.10:</strong> Write a function <code class="docutils literal notranslate"><span class="pre">simulate_and_test_statistic</span></code> to compute one trial of our A/B test. Your function should run a simulation and return a test statistic.</p>
<p>Note: The test here is fairly lenient, if you have an issue with the following questions, make sure to take a look at your answer to 3.9. Specifically, make sure that you are taking the directionality of our alternative hypothesis into account.</p>
<!--
BEGIN QUESTION
name: q3_10
--><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">simulate_and_test_statistic</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">labels_col</span><span class="p">,</span> <span class="n">values_col</span><span class="p">):</span>
    <span class="o">...</span>

<span class="n">simulate_and_test_statistic</span><span class="p">(</span><span class="n">change_in_death_rates</span><span class="p">,</span> <span class="s2">&quot;Death Penalty&quot;</span><span class="p">,</span> <span class="s2">&quot;Murder Rate&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ok</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span><span class="s2">&quot;q3_10&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Question 3.11:</strong> Simulate 5000 trials of our A/B test and store the test statistics in an array called <code class="docutils literal notranslate"><span class="pre">differences</span></code></p>
<!--
BEGIN QUESTION
name: q3_11
--><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># This cell might take a couple seconds to run</span>
<span class="n">differences</span> <span class="o">=</span> <span class="n">make_array</span><span class="p">()</span>

<span class="o">...</span>
                                                 
<span class="n">differences</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ok</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span><span class="s2">&quot;q3_11&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>Run the cell below to view a histogram of your simulated test statistics plotted with your observed test statistic</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Table</span><span class="p">()</span><span class="o">.</span><span class="n">with_column</span><span class="p">(</span><span class="s1">&#39;Difference Between Group Means&#39;</span><span class="p">,</span> <span class="n">differences</span><span class="p">)</span><span class="o">.</span><span class="n">hist</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">observed_difference</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Question 3.12:</strong> Find the p-value for your test and assign it to <code class="docutils literal notranslate"><span class="pre">empirical_P</span></code></p>
<!--
BEGIN QUESTION
name: q3_12
--><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">empirical_P</span> <span class="o">=</span> <span class="o">...</span>
<span class="n">empirical_P</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ok</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span><span class="s2">&quot;q3_12&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Question 3.13:</strong> Using a 5% P-value cutoff, draw a conclusion about the null and alternative hypotheses. Describe your findings using simple, non-technical language. What does your analysis tell you about murder rates after the death penalty was suspended? What can you claim about causation from your statistical analysis?</p>
<!--
BEGIN QUESTION
name: q3_13
--><p><em>Write your answer here, replacing this text.</em></p>
<p><strong>You’re done! Congratulations.</strong> Run the cells below to check your work and submit to okpy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># For your convenience, you can run this cell to run all the tests at once!</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Running all tests...&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="p">[</span><span class="n">ok</span><span class="o">.</span><span class="n">grade</span><span class="p">(</span><span class="n">q</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;tests&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">q</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished running all tests.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Submit the project!</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ok</span><span class="o">.</span><span class="n">submit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>


              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>